

set hive.exec.dynamic.partition.mode=nonstrict;


insert overwrite table hmda_hist.tf_nave partition(am)
select 
tfnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfnavecorrorigen,
tfnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfnavefechregistro,
tfnavenumact,
tfnavenombnave,
tfnavenombnavemv,
tfnavenumimo,
tfnavenumimomv,
tfnavemmsi,
tfnavemmsimv,
tfnavenumeni,
tfnavenumenimv,
tfnavecallsign,
tfnavecallsignmv,
tfnavebandera,
stpaisbanderaid,
tfnavebanderamv,
tfnavematricula,
tfnavematriculamv,
tfnaveidsismep,
tfnaveidsismepmv,
tfnavecodernp,
tfnavecodernpmv,
tfnavefoliorpmn,
tfnavefoliorpmnmv,
tfnaveidmt,
tfnaveidmtmv,
tfnavefoliofuente,
tfnavefoliofuentemv,
tfnavenumidfuente,
tfnavenumidfuentemv,
tfnavetiponave,
sttiponaveid,
tfnavetiponavemv,
tfnavecatnave,
stcatnaveid,
tfnavecatnavemv,
tfnavetipocarga,
sttpcargarepid,
tfnavetipocargamv,
tfnaveclase,
tcclasenaveid,
tfnaveclasemv,
tfnavelocmatricula,
stlocalmatid,
tfnavelocmatriculamv,
tfnavefechmatricula,
tfnavefechmatriculamv,
tfnavematrservicio,
tfnavematrserviciomv,
tfnavematrtrafico,
tfnavematrtraficomv,
tfnavelocpuertobase,
stlocalptobaseid,
tfnavelocpuertobasemv,
tfnavelitoral,
stlitoralnaveid,
tfnavelitoralmv,
tfnaveestadonave,
tcestnaveid,
tfnaveestadonavemv,
tfnavenrocodeseriedisp,
tfnavenrocodeseriedispmv,
tfnavedataadic,
tfnavedataadicmv,
tfnaverawdata,
tfnaveestfusion,
tfnaveregobsoleto,
tfnavefechobsoleto,
storganizacionid,
substr(cast(tgdimdatekey as string),1,6) am
from
default.tf_nave
;


insert overwrite table hmda_hist.tf_admin_nave partition(am)
select
tfadmnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfadmnavecorrorigen,
tfadmnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfadmnavefechregistro,
tfadmnavenumact,
tfadmnaveprop,
tfadmnavepropmv,
tfadmncodeproprnp,
tfadmncodeproprnpmv,
tfadmincodeproprfc,
tfadmincodeproprfcmv,
tfadmnpropdireccion,
stlocaldirid,
tfadmnpropdireccionmv,
tfadmnaveproplocal,
tfadmnaveproplocalmv,
tfadmnaveproppuerto,
tfadmnaveproppuertomv,
tfadmnaverepr,
tfadmnavereprmv,
tfadmnaveadmin,
tfadmnaveadminmv,
tfadmnaveaseg,
tfadmnaveasegmv,
tfadmnavearma,
tfadmnavearmamv,
tfadmnaveagru,
tfadmnaveagrumv,
tfadmnavesocclasi,
tfadmnavesocclasimv,
tfadmnavecontacto,
tfadmnavecontactomv,
tfadmnavefonoprop,
tfadmnavefonopropmv,
tfadmnaveemaiprop,
tfadmnaveemaipropmv,
tfadmnavedataadic,
tfadmnavedataadicmv,
tfadmnaverawdata,
tfadmnaveestfusion,
tfadmnaveregobsoleto,
tfadmnavefechobsoleto,
substr(cast(tgdimdatekey as string),1,6) am
from default.tf_admin_nave
;


insert overwrite table hmda_hist.tf_dimension_nave partition(am)
select
tfdimnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfdimnavecorrorigen,
tfdimnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfdimnavefechregistro,
tfdimnavenumact,
tfdimnaveeslora,
tfdimnaveesloramv,
tfdimnavemanga,
tfdimnavemangamv,
tfdimnavepuntal,
tfdimnavepuntalmv,
tfdimnavedima,
tfdimnavedimamv,
tfdimnavedimb,
tfdimnavedimbmv,
tfdimnavedimc,
tfdimnavedimcmv,
tfdimnavedimd,
tfdimnavedimdmv,
tfdimnavearqbruto,
tfdimnavearqbrutomv,
tfdimnavearquneto,
tfdimnavearqunetomv,
tfdimnavepesomuerto,
tfdimnavepesomuertomv,
tfdimnavedesplazam,
tfdimnavedesplazammv,
tfdimnavecarga,
tfdimnavecargamv,
tfdimnavetipocarga,
tfdimnavetipocargamv,
tfdimnaveminvelocidad,
tfdimnaveminvelocidadmv,
tfdimnavemaxvelocidad,
tfdimnavemaxvelocidadmv,
tfdimnavenomvelocidad,
tfdimnavenomvelocidadmv,
tfdimnavemaxcalado,
tfdimnavemaxcaladomv,
tfdimnavecaladopopa,
tfdimnavecaladopopamv,
tfdimnavecaladoproa,
tfdimnavecaladoproamv,
tfdimnaveanioconstruc,
tfdimnaveanioconstrucmv,
tfdimnavelugarconstruc,
tfdimnavelugarconstrucmv,
tfdimnavenumcasco,
tfdimnavenumcascomv,
tfdimnavematercasco,
tfdimnavematercascomv,
tfdimnavenummotores,
tfdimnavenummotoresmv,
tfdimnavemintripulacion,
tfdimnavemintripulacionmv,
tfdimnavecaptripulacion,
tfdimnavecaptripulacionmv,
tfdimnavecappasajeros,
tfdimnavecappasajerosmv,
tfdimnavecapteu,
tfdimnavecapteumv,
tfdimnavecaptanques,
tfdimnavecaptanquesmv,
tfdimnavenumbodegas,
tfdimnavenumbodegasmv,
tfdimnavedataadic,
tfdimnavedataadicmv,
tfdimnaverawdata,
tfdimnaveestfusion,
tfdimnaveregobsoleto,
tfdimnavefechobsoleto,
substr(cast(tgdimdatekey as string),1,6) am
from default.tf_dimension_nave
;


add  jar  ./gis-tools-for-hadoop/lib/esri-geometry-api.jar;
add  jar  ./gis-tools-for-hadoop/lib/spatial-sdk-hadoop.jar;

create temporary function ST_Point as 'com.esri.hadoop.hive.ST_Point';
create temporary function ST_Contains as 'com.esri.hadoop.hive.ST_Contains';


SET mapred.child.java.opts="-server1g -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit";


insert overwrite table hmda_hist.tf_posicion_nave partition(am)
select
tfposnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfposnavecorrorigen,
tfposnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfposnavefechregistro,
tfposnavenumact,
tfposnaveposilatitud,
tfposnaveposilatitudmv,
tfposnaveposilongitud,
tfposnaveposilongitudmv,
tfposnaverumbo,
tfposnaverumbomv,
tfposnaveheading,
tfposnaveheadingmv,
tfposnavevelocidad,
tfposnavevelocidadmv,
tfposnavealtitud,
tfposnavealtitudmv,
tfposnavecaladorepo,
tfposnavecaladorepomv,
tfposnaverotaais,
tfposnaverotaaismv,
tfposnaveestnaveg,
tcestnavid,
tfposnaveestnavegmv,
tfposnaveeta,
tfposnaveetamv,
tfposnaveorigen,
stlocalptoorivjeid,
tfposnaveorigenmv,
tfposnavedestino,
stlocalptodesvjeid,
tfposnavedestinomv,
tfposnavesensfte,
tfposnavesensftemv,
tfposnaveposicalidad,
tfposnaveposicalidadmv,
tfposnavearearep,
stlitoralrepid,
tfposnavearearepmv,
tfposnavedataadic,
tfposnavedataadicmv,
tfposnaverawdata,
tfposnaveestfusion,
tfposnaveregobsoleto,
tfposnavefechobsoleto,
st_point(tfposnaveposilatitud,tfposnaveposilongitud) geom,
substr(cast(tgdimdatekey as string),1,6) am
from default.tf_posicion_nave
;



