
create database hmda_hist location "/hive/hmdahist";

set hive.exec.dynamic.partition.mode=nonstrict;

create table hmda_hist.tf_nave (
tfnavecorrsistfte         bigint,
tgasocididmaster          bigint,
tgftesistidfte            int,
tfnavecorrorigen          bigint,
tfnaveprimfechcontacto    string,
tgdimdatekey              bigint,
tgdimtimekey              bigint,
tfnavefechregistro        string,
tfnavenumact              int,
tfnavenombnave            string,
tfnavenombnavemv          int,
tfnavenumimo              bigint,
tfnavenumimomv            int,
tfnavemmsi                bigint,
tfnavemmsimv              int,
tfnavenumeni              bigint,
tfnavenumenimv            int,
tfnavecallsign            string,
tfnavecallsignmv          int,
tfnavebandera             string,
stpaisbanderaid           int,
tfnavebanderamv           int,
tfnavematricula           string,
tfnavematriculamv         int,
tfnaveidsismep            string,
tfnaveidsismepmv          int,
tfnavecodernp             string,
tfnavecodernpmv           int,
tfnavefoliorpmn           string,
tfnavefoliorpmnmv         int,
tfnaveidmt                bigint,
tfnaveidmtmv              int,
tfnavefoliofuente         string,
tfnavefoliofuentemv       int,
tfnavenumidfuente         bigint,
tfnavenumidfuentemv       int,
tfnavetiponave            string,
sttiponaveid              int,
tfnavetiponavemv          int,
tfnavecatnave             string,
stcatnaveid               int,
tfnavecatnavemv           int,
tfnavetipocarga           string,
sttpcargarepid            int,
tfnavetipocargamv         int,
tfnaveclase               string,
tcclasenaveid             int,
tfnaveclasemv             int,
tfnavelocmatricula        string,
stlocalmatid              int,
tfnavelocmatriculamv      int,
tfnavefechmatricula       string,
tfnavefechmatriculamv     int,
tfnavematrservicio        int,
tfnavematrserviciomv      int,
tfnavematrtrafico         int,
tfnavematrtraficomv       int,
tfnavelocpuertobase       string,
stlocalptobaseid          int,
tfnavelocpuertobasemv     int,
tfnavelitoral             string,
stlitoralnaveid           int,
tfnavelitoralmv           int,
tfnaveestadonave          string,
tcestnaveid               int,
tfnaveestadonavemv        int,
tfnavenrocodeseriedisp    string,
tfnavenrocodeseriedispmv  int,
tfnavedataadic            string,
tfnavedataadicmv          int,
tfnaverawdata             string,
tfnaveestfusion           int,
tfnaveregobsoleto         boolean,
tfnavefechobsoleto        string,
storganizacionid          int)
partitioned by (am string)
stored as orc;

insert overwrite table hmda_hist.tf_nave partition(am)
select 
tfnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfnavecorrorigen,
tfnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfnavefechregistro,
tfnavenumact,
tfnavenombnave,
tfnavenombnavemv,
tfnavenumimo,
tfnavenumimomv,
tfnavemmsi,
tfnavemmsimv,
tfnavenumeni,
tfnavenumenimv,
tfnavecallsign,
tfnavecallsignmv,
tfnavebandera,
stpaisbanderaid,
tfnavebanderamv,
tfnavematricula,
tfnavematriculamv,
tfnaveidsismep,
tfnaveidsismepmv,
tfnavecodernp,
tfnavecodernpmv,
tfnavefoliorpmn,
tfnavefoliorpmnmv,
tfnaveidmt,
tfnaveidmtmv,
tfnavefoliofuente,
tfnavefoliofuentemv,
tfnavenumidfuente,
tfnavenumidfuentemv,
tfnavetiponave,
sttiponaveid,
tfnavetiponavemv,
tfnavecatnave,
stcatnaveid,
tfnavecatnavemv,
tfnavetipocarga,
sttpcargarepid,
tfnavetipocargamv,
tfnaveclase,
tcclasenaveid,
tfnaveclasemv,
tfnavelocmatricula,
stlocalmatid,
tfnavelocmatriculamv,
tfnavefechmatricula,
tfnavefechmatriculamv,
tfnavematrservicio,
tfnavematrserviciomv,
tfnavematrtrafico,
tfnavematrtraficomv,
tfnavelocpuertobase,
stlocalptobaseid,
tfnavelocpuertobasemv,
tfnavelitoral,
stlitoralnaveid,
tfnavelitoralmv,
tfnaveestadonave,
tcestnaveid,
tfnaveestadonavemv,
tfnavenrocodeseriedisp,
tfnavenrocodeseriedispmv,
tfnavedataadic,
tfnavedataadicmv,
tfnaverawdata,
tfnaveestfusion,
tfnaveregobsoleto,
tfnavefechobsoleto,
storganizacionid,
substr(cast(tgdimdatekey as string),1,6) am
from
default.tf_nave
;


+---------------------------+------------+----------+--+




create table hmda_hist.tf_admin_nave (
tfadmnavecorrsistfte       bigint,
tgasocididmaster           bigint,
tgftesistidfte             int,
tfadmnavecorrorigen        bigint,
tfadmnaveprimfechcontacto  string,
tgdimdatekey               bigint,
tgdimtimekey               bigint,
tfadmnavefechregistro      string,
tfadmnavenumact            int,
tfadmnaveprop              string,
tfadmnavepropmv            int,
tfadmncodeproprnp          string,
tfadmncodeproprnpmv        int,
tfadmincodeproprfc         string,
tfadmincodeproprfcmv       int,
tfadmnpropdireccion        string,
stlocaldirid               int,
tfadmnpropdireccionmv      int,
tfadmnaveproplocal         string,
tfadmnaveproplocalmv       int,
tfadmnaveproppuerto        string,
tfadmnaveproppuertomv      int,
tfadmnaverepr              string,
tfadmnavereprmv            int,
tfadmnaveadmin             string,
tfadmnaveadminmv           int,
tfadmnaveaseg              string,
tfadmnaveasegmv            int,
tfadmnavearma              string,
tfadmnavearmamv            int,
tfadmnaveagru              string,
tfadmnaveagrumv            int,
tfadmnavesocclasi          string,
tfadmnavesocclasimv        int,
tfadmnavecontacto          string,
tfadmnavecontactomv        int,
tfadmnavefonoprop          string,
tfadmnavefonopropmv        int,
tfadmnaveemaiprop          string,
tfadmnaveemaipropmv        int,
tfadmnavedataadic          string,
tfadmnavedataadicmv        int,
tfadmnaverawdata           string,
tfadmnaveestfusion         int,
tfadmnaveregobsoleto       boolean,
tfadmnavefechobsoleto      string)
partitioned by (am string)
stored as orc;

insert overwrite table hmda_hist.tf_admin_nave partition(am)
select
tfadmnavecorrsistfte,
tgasocididmaster,
tgftesistidfte,
tfadmnavecorrorigen,
tfadmnaveprimfechcontacto,
tgdimdatekey,
tgdimtimekey,
tfadmnavefechregistro,
tfadmnavenumact,
tfadmnaveprop,
tfadmnavepropmv,
tfadmncodeproprnp,
tfadmncodeproprnpmv,
tfadmincodeproprfc,
tfadmincodeproprfcmv,
tfadmnpropdireccion,
stlocaldirid,
tfadmnpropdireccionmv,
tfadmnaveproplocal,
tfadmnaveproplocalmv,
tfadmnaveproppuerto,
tfadmnaveproppuertomv,
tfadmnaverepr,
tfadmnavereprmv,
tfadmnaveadmin,
tfadmnaveadminmv,
tfadmnaveaseg,
tfadmnaveasegmv,
tfadmnavearma,
tfadmnavearmamv,
tfadmnaveagru,
tfadmnaveagrumv,
tfadmnavesocclasi,
tfadmnavesocclasimv,
tfadmnavecontacto,
tfadmnavecontactomv,
tfadmnavefonoprop,
tfadmnavefonopropmv,
tfadmnaveemaiprop,
tfadmnaveemaipropmv,
tfadmnavedataadic,
tfadmnavedataadicmv,
tfadmnaverawdata,
tfadmnaveestfusion,
tfadmnaveregobsoleto,
tfadmnavefechobsoleto,
substr(cast(tgdimdatekey as string),1,6) am
from default.tf_admin_nave
;

+----------------------------+------------+----------+--+


create table hmda_hist.tf_dimension_nave (
tfdimnavecorrsistfte       bigint,
tgasocididmaster           bigint,
tgftesistidfte             int,
tfdimnavecorrorigen        bigint,
tfdimnaveprimfechcontacto  string,
tgdimdatekey               bigint,
tgdimtimekey               bigint,
tfdimnavefechregistro      string,
tfdimnavenumact            int,
tfdimnaveeslora            double,
tfdimnaveesloramv          int,
tfdimnavemanga             double,
tfdimnavemangamv           int,
tfdimnavepuntal            double,
tfdimnavepuntalmv          int,
tfdimnavedima              double,
tfdimnavedimamv            int,
tfdimnavedimb              double,
tfdimnavedimbmv            int,
tfdimnavedimc              double,
tfdimnavedimcmv            int,
tfdimnavedimd              double,
tfdimnavedimdmv            int,
tfdimnavearqbruto          double,
tfdimnavearqbrutomv        int,
tfdimnavearquneto          double,
tfdimnavearqunetomv        int,
tfdimnavepesomuerto        double,
tfdimnavepesomuertomv      int,
tfdimnavedesplazam         double,
tfdimnavedesplazammv       int,
tfdimnavecarga             double,
tfdimnavecargamv           int,
tfdimnavetipocarga         string,
tfdimnavetipocargamv       int,
tfdimnaveminvelocidad      double,
tfdimnaveminvelocidadmv    int,
tfdimnavemaxvelocidad      double,
tfdimnavemaxvelocidadmv    int,
tfdimnavenomvelocidad      double,
tfdimnavenomvelocidadmv    int,
tfdimnavemaxcalado         double,
tfdimnavemaxcaladomv       int,
tfdimnavecaladopopa        double,
tfdimnavecaladopopamv      int,
tfdimnavecaladoproa        double,
tfdimnavecaladoproamv      int,
tfdimnaveanioconstruc      int,
tfdimnaveanioconstrucmv    int,
tfdimnavelugarconstruc     string,
tfdimnavelugarconstrucmv   int,
tfdimnavenumcasco          string,
tfdimnavenumcascomv        int,
tfdimnavematercasco        string,
tfdimnavematercascomv      int,
tfdimnavenummotores        int,
tfdimnavenummotoresmv      int,
tfdimnavemintripulacion    int,
tfdimnavemintripulacionmv  int,
tfdimnavecaptripulacion    int,
tfdimnavecaptripulacionmv  int,
tfdimnavecappasajeros      int,
tfdimnavecappasajerosmv    int,
tfdimnavecapteu            int,
tfdimnavecapteumv          int,
tfdimnavecaptanques        int,
tfdimnavecaptanquesmv      int,
tfdimnavenumbodegas        int,
tfdimnavenumbodegasmv      int,
tfdimnavedataadic          string,
tfdimnavedataadicmv        int,
tfdimnaverawdata           string,
tfdimnaveestfusion         int,
tfdimnaveregobsoleto       boolean,
tfdimnavefechobsoleto      string)
partitioned by (am string)
stored as orc;

insert overwrite table hmda_hist.tf_dimension_nave partition(am)
select

from default.tf_dimension_nave
;

+----------------------------+------------+----------+--+


create table hmda_hist.tf_posicion_nave (
tfposnavecorrsistfte       bigint,
tgasocididmaster           bigint,
tgftesistidfte             int,
tfposnavecorrorigen        bigint,
tfposnaveprimfechcontacto  string,
tgdimdatekey               bigint,
tgdimtimekey               bigint,
tfposnavefechregistro      string,
tfposnavenumact            int,
tfposnaveposilatitud       double,
tfposnaveposilatitudmv     int,
tfposnaveposilongitud      double,
tfposnaveposilongitudmv    int,
tfposnaverumbo             double,
tfposnaverumbomv           int,
tfposnaveheading           double,
tfposnaveheadingmv         int,
tfposnavevelocidad         double,
tfposnavevelocidadmv       int,
tfposnavealtitud           double,
tfposnavealtitudmv         int,
tfposnavecaladorepo        double,
tfposnavecaladorepomv      int,
tfposnaverotaais           double,
tfposnaverotaaismv         int,
tfposnaveestnaveg          string,
tcestnavid                 int,
tfposnaveestnavegmv        int,
tfposnaveeta               string,
tfposnaveetamv             int,
tfposnaveorigen            string,
stlocalptoorivjeid         int,
tfposnaveorigenmv          int,
tfposnavedestino           string,
stlocalptodesvjeid         int,
tfposnavedestinomv         int,
tfposnavesensfte           string,
tfposnavesensftemv         int,
tfposnaveposicalidad       int,
tfposnaveposicalidadmv     int,
tfposnavearearep           string,
stlitoralrepid             int,
tfposnavearearepmv         int,
tfposnavedataadic          string,
tfposnavedataadicmv        int,
tfposnaverawdata           string,
tfposnaveestfusion         int,
tfposnaveregobsoleto       boolean,
tfposnavefechobsoleto      string)
partitioned by (am string)
stored as orc;

insert overwrite table hmda_latest.tf_posicion_nave (partition am)
select

from default.tf_posicion_nave
;

+----------------------------+------------+----------+--+



